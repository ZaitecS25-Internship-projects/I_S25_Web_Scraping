{% extends "base.html" %}
{% block title %}Mis Alertas - Oposiciones BOE{% endblock %}

{% block content %}
<div class="container py-4 contenido-principal">
  <h2 class="mb-4 text-center hero-title">üì¨ Gesti√≥n de Alertas</h2>

  <!-- <div class="row">
    <div class="col-md-3 mb-4">
      <div class="list-group shadow-sm">
        <a href="{{ url_for('user.configuracion_cuenta') }}" class="list-group-item list-group-item-action active"
          data-bs-toggle="list">
          <i class="bi bi-person-badge me-2"></i> Perfil
        </a>
        <a href="{{ url_for('user.configuracion_cuenta') }}" class="list-group-item list-group-item-action"
          data-bs-toggle="list">
          <i class="bi bi-shield-lock me-2"></i> Seguridad
        </a>
        <a href="{{ url_for('user.newsletter_prefs') }}" class="list-group-item list-group-item-action">
          <i class="bi bi-envelope me-2"></i> Alertas / Email
        </a>
      </div>
    </div> -->

  <div class="col-md-9">

    <div class="card shadow-sm mb-4">
      <div class="card-header bg-white py-3">
        <h5 class="mb-0 text-primary">Suscripciones por Correo</h5>
      </div>
      <div class="card-body">
        <p class="text-muted">
          Configura aqu√≠ qu√© notificaciones quieres recibir en: <strong>{{ user.email }}</strong>
        </p>

        <form method="POST" action="{{ url_for('user.newsletter_prefs') }}">
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="alerta_diaria" name="alerta_diaria" {% if
              prefs['alerta_diaria'] %}checked{% endif %}>
            <label class="form-check-label" for="alerta_diaria">
              <strong>Resumen diario</strong>
              <div class="text-muted small">Recibe un email cada ma√±ana con las nuevas oposiciones.</div>
            </label>
          </div>

          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="alerta_favoritos" name="alerta_favoritos" {% if
              prefs['alerta_favoritos'] %}checked{% endif %}>
            <label class="form-check-label" for="alerta_favoritos">
              <strong>Cambios en mis favoritas</strong>
              <div class="text-muted small">Av√≠same si hay actualizaciones en mis oposiciones guardadas.</div>
            </label>
          </div>

          <hr class="my-4">

          <h6 class="mb-3">Filtrar resumen diario por departamento:</h6>
          <div class="mb-3">
            <select class="form-select" name="departamento_filtro" aria-label="Seleccionar departamento">
              <option value="Todos" {% if prefs['departamento_filtro']=='Todos' %}selected{% endif %}>
                Todos los departamentos
              </option>
              {% for dept in departamentos %}
              <option value="{{ dept }}" {% if prefs['departamento_filtro']==dept %}selected{% endif %}>
                {{ dept }}
              </option>
              {% endfor %}
            </select>
            <div class="form-text">Este filtro tambi√©n se aplica al bot√≥n de env√≠o manual de abajo.</div>
          </div>

          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-save"></i> Guardar Preferencias
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="card shadow-sm border-warning">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h6 class="fw-bold mb-1"><i class="bi bi-send-check text-warning"></i> ¬øQuieres probar tus alertas?</h6>
          <small class="text-muted">Te enviaremos ahora mismo un resumen con las √∫ltimas oposiciones seg√∫n tu
            filtro.</small>
        </div>

        <form method="POST" action="{{ url_for('user.enviar_resumen_ahora') }}">
          <button type="submit" class="btn btn-outline-dark">
            Enviar Email Ahora
          </button>
        </form>
      </div>
    </div>

  </div>
</div>
</div>
{% endblock %}