<!--
Plantilla de preferencias - Checklist de departamentos

Permite al usuario seleccionar los departamentos que desea ver
en la página principal.
-->

{% extends 'base.html' %}

{% block content %}
<div class="row">
  <div class="col-md-8 mx-auto">
    <h1 class="mb-4">Mis Departamentos</h1>
    <p class="text-muted mb-4">
      Selecciona los departamentos de los que quieres ver oposiciones. 
      Solo se mostrarán los departamentos seleccionados en la página principal.
    </p>

    <form method="POST" action="{{ url_for('preferencias') }}">
      <div class="card shadow-sm">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectAll()">
                Seleccionar todos
              </button>
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="deselectAll()">
                Deseleccionar todos
              </button>
            </div>
            <div>
              <button type="submit" class="btn btn-primary">Guardar preferencias</button>
              <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancelar</a>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row g-3">
            {% for dep in todos_departamentos %}
              <div class="col-md-6 col-lg-4">
                <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    name="departamento" 
                    value="{{ dep }}" 
                    id="dep_{{ loop.index }}"
                    {% if dep in departamentos_usuario %}checked{% endif %}
                  >
                  <label class="form-check-label" for="dep_{{ loop.index }}">
                    {{ dep }}
                  </label>
                </div>
              </div>
            {% endfor %}
          </div>

          {% if not todos_departamentos %}
            <div class="alert alert-info">
              No hay departamentos disponibles todavía. 
              <a href="{{ url_for('do_scrape') }}">Actualiza los datos del BOE</a> primero.
            </div>
          {% endif %}
        </div>
      </div>
    </form>
  </div>
</div>

<script>
function selectAll() {
  const checkboxes = document.querySelectorAll('input[name="departamento"]');
  checkboxes.forEach(cb => cb.checked = true);
}

function deselectAll() {
  const checkboxes = document.querySelectorAll('input[name="departamento"]');
  checkboxes.forEach(cb => cb.checked = false);
}
</script>
{% endblock %}

